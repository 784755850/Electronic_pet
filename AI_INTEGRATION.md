# AI 接入与本地模型指南

电子宠物现已支持多种 AI 服务接入，您可以选择便捷的云端服务，也可以接入本地模型（保护隐私且免费），甚至可以接入 **小智 AI (XiaoZhi)** 协议以获得更丰富的互动体验。

## 1. 支持的服务商

### A. 阿里云百炼 (云端)
*   **适用人群**: 希望获得高质量对话体验，且无需配置本地环境的用户。
*   **准备工作**: 需要从 [阿里云百炼控制台](https://bailian.console.aliyun.com/) 获取 API Key。
*   **设置步骤**:
    1.  进入 **设置 (Settings)** -> **AI**。
    2.  选择 **服务提供商 (Provider)**: `阿里云百炼 (Alibaba Bailian)`。
    3.  输入您的 **API Key**。
    4.  模型: 默认为 `qwen-turbo` (通义千问)。

### B. 本地 / OpenAI 兼容接口 (本地)
*   **适用人群**: 重视隐私、希望离线使用或免费使用的用户。
*   **支持工具**: **Ollama**, **LM Studio**, **LocalAI**, 或任何兼容 OpenAI 协议的服务器。

#### 使用 Ollama 接入
1.  **安装 Ollama**: 从 [ollama.com](https://ollama.com/) 下载并安装。
2.  **下载模型**: 在终端运行 `ollama run qwen2:0.5b` (低配电脑推荐) 或 `ollama run llama3`。
3.  **宠物设置**:
    *   **服务提供商**: `本地/OpenAI兼容 (Local/OpenAI)`。
    *   **Base URL**: `http://localhost:11434/v1`
    *   **模型 (Model)**: `qwen2:0.5b` (必须与您下载的模型名称一致)。
    *   **API Key**: 留空 (或随意填写 `ollama`)。

#### 使用 LM Studio 接入
1.  **安装 LM Studio**: 从 [lmstudio.ai](https://lmstudio.ai/) 下载。
2.  **加载模型**: 搜索并下载您喜欢的模型 (例如 "Qwen 1.5 Chat")。
3.  **启动服务器**: 点击左侧的 `<->` (Server) 图标，然后点击 **Start Server**。
4.  **宠物设置**:
    *   **服务提供商**: `本地/OpenAI兼容 (Local/OpenAI)`。
    *   **Base URL**: `http://localhost:1234/v1`
    *   **模型 (Model)**: 保持默认或填写当前加载的模型名。
    *   **API Key**: `lm-studio`。

### C. 小智 AI (XiaoZhi) 协议接入 (开发中)
*   **适用人群**: 拥有小智 AI 硬件或希望体验更深度语音/情绪交互的用户。
*   **核心特性**: 支持通过 WebSocket 实时通信，并利用 Emoji 驱动宠物做出特定动作（如开心、睡觉、学习等）。
*   **详细协议**: 请参阅 [小智 AI 接入方案](docs/XIAOZHI_INTEGRATION.md)。

## 2. AI 驱动的动作系统

当 AI 回复中包含特定的 **Emoji** 时，电子宠物会自动触发相应的动画：

| Emoji | 触发动作 | 宠物状态变化 | 视觉效果 |
| :--- | :--- | :--- | :--- |
| 😊/😄/😁 | 玩耍 (Playing) | 心情大幅增加 | 开心跳跃，有球在身边弹跳 |
| 💤/😴 | 睡觉 (Sleeping) | 恢复体力 | 闭眼呼吸，头顶冒出 "Zzz" |
| 🍎/🍔/🍗 | 进食 (Eating) | 减少饥饿 | 苹果飞向嘴边，做出咀嚼动作 |
| 💼/👔 | 工作 (Working) | 赚取金币 | 出现公文包，流汗努力工作 |
| 📚/📖 | 学习 (Studying) | 增加智慧 | 戴上眼镜，面前出现一本书 |
| 🛁/🧼 | 洗澡 (Cleaning) | 增加清洁度 | 出现泡泡和刷子 |
| 😢/😭 | 难过 (Sad) | 心情降低 | 垂头丧气 |

**提示**: 您可以在对话中引导 AI，例如说“去吃个苹果吧”，AI 回复“好的 🍎”，宠物就会真的开始吃苹果！

## 3. 常见问题 (Troubleshooting)

*   **连接失败 (Connection Refused)**: 请检查您的本地服务器 (Ollama/LM Studio) 是否已启动。
*   **响应缓慢**: 本地模型的速度取决于您的电脑性能。如果太慢，请尝试更小的模型 (如 `qwen2:0.5b` 或 `phi3`)。
*   **上下文限制**: 目前宠物会发送完整的对话历史。如果对话过长导致报错，请清除聊天记录重置上下文。
