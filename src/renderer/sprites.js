// 像素精灵绘制模块
// 使用16x16像素网格绘制复古LCD风格宠物

// 默认像素颜色 - 复古单色LCD风格
let COLORS = {
  bg: 'transparent',
  dark: '#1a1a2e',      // 深色像素
  mid: '#4a4a6a',       // 中间色
  light: '#8a8aaa',     // 浅色/阴影
  glow: '#c8d8c8',      // 发光效果
  // 新增扩展色
  pink: '#f8c8d8',      // 浅粉心形
  yellow: '#f8f8a8',    // 浅黄高光
  white: '#f8f8f8',     // 白色高光
  paleViolet: '#c8b8e8', // 淡紫蛋体
  gold: '#c8aa6a',       // 鎏金
  brightGold: '#e8ca8a', // 亮金
  silver: '#e8e8f8',     // 浅银
  darkBrown: '#4a3a2a'   // 深棕(皇冠描边)
}

// 更新颜色配置
function updateColors(newColors) {
  if (newColors) {
    COLORS.dark = newColors.dark || COLORS.dark
    COLORS.mid = newColors.mid || COLORS.mid
    COLORS.light = newColors.light || COLORS.light
  }
}

// 像素精灵数据 (16x16)
// 0=透明, 1=深色, 2=中间色, 3=浅色, 4=淡紫, 5=粉色, 6=黄色, 7=白色, 8=裂纹
const SPRITES = {
  // 蛋 - 静态 (幼生期 带心形+裂纹)
  egg: {
    idle: [
      // 心形装饰 (顶部)
      [0,0,0,0,5,5,0,0,0,5,5,0,0,0,0,0],
      [0,0,0,5,5,5,5,5,5,5,5,5,0,0,0,0],
      [0,0,0,5,5,5,5,5,5,5,5,5,0,0,0,0],
      [0,0,0,0,5,5,5,5,5,5,5,0,0,0,0,0],
      [0,0,0,0,0,5,5,5,5,5,0,0,0,0,0,0],
      [0,0,0,0,0,0,5,5,5,0,0,0,0,0,0,0],
      // 蛋体
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
      [0,0,0,0,1,4,4,3,4,4,4,1,0,0,0,0],
      [0,0,0,1,4,3,3,4,4,4,4,4,1,0,0,0],
      [0,0,0,1,4,3,4,4,8,8,4,4,1,0,0,0],
      [0,0,1,4,4,4,4,4,4,8,4,4,4,1,0,0],
      [0,0,1,4,4,4,4,4,4,4,4,4,4,1,0,0],
      [0,0,1,4,4,4,4,4,4,4,4,4,4,1,0,0],
      [0,0,0,1,4,4,4,4,4,4,4,4,1,0,0,0],
      [0,0,0,0,1,4,4,4,4,4,4,1,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0]
    ],
    // 蛋摇晃动画帧
    wobble: [
      [0,0,0,0,0,5,5,0,0,5,5,0,0,0,0,0],
      [0,0,0,0,5,5,5,5,5,5,5,5,0,0,0,0],
      [0,0,0,0,5,5,5,5,5,5,5,5,0,0,0,0],
      [0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0],
      [0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,5,5,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0],
      [0,0,0,0,0,1,4,4,3,4,4,4,1,0,0,0],
      [0,0,0,0,1,4,3,3,4,4,4,4,4,1,0,0],
      [0,0,0,0,1,4,3,4,4,8,8,4,4,1,0,0],
      [0,0,0,1,4,4,4,4,4,4,8,4,4,4,1,0],
      [0,0,0,1,4,4,4,4,4,4,4,4,4,4,1,0],
      [0,0,0,1,4,4,4,4,4,4,4,4,4,4,1,0],
      [0,0,0,0,1,4,4,4,4,4,4,4,4,1,0,0],
      [0,0,0,0,0,1,4,4,4,4,4,4,1,0,0,0],
      [0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0]
    ]
  },
  
  // 幼年宠物 - 成长期 (破壳露出脑袋+升级心形+星点)
  baby: {
    idle: [
      // 星点+心形装饰
      [0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,7,7,7,5,5,0,0,0,5,5,0,0,0,0,0],
      [0,0,7,5,6,5,5,5,5,6,5,5,0,0,0,0],
      [0,0,0,0,5,5,5,5,5,5,5,5,0,0,0,0],
      [0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0],
      [0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0],
      // 露出的小脑袋
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
      [0,0,0,0,1,3,2,2,2,2,7,1,0,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      // 蛋壳(破裂)+高光
      [0,0,0,6,6,2,2,2,2,2,2,6,6,0,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,3,3,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0]
    ],
    // 走路帧1
    walk1: [
      [0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,7,7,7,5,5,0,0,0,5,5,0,0,0,0,0],
      [0,0,7,5,6,5,5,5,5,6,5,5,0,0,0,0],
      [0,0,0,0,5,5,5,5,5,5,5,5,0,0,0,0],
      [0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0],
      [0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
      [0,0,0,0,1,3,2,2,2,2,7,1,0,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,6,6,2,2,2,2,2,2,6,6,0,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,3,3,2,2,2,2,2,2,2,2,1,0,0],
      [0,1,1,1,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,2,1,0,0,0],
      [0,0,0,0,0,1,1,1,0,1,2,2,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0]
    ],
    // 走路帧2
    walk2: [
      [0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0],
      [0,0,0,0,5,5,0,0,0,5,7,7,7,0,0,0],
      [0,0,0,5,6,5,5,5,5,6,5,7,0,0,0,0],
      [0,0,0,0,5,5,5,5,5,5,5,5,0,0,0,0],
      [0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0],
      [0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
      [0,0,0,0,1,7,2,2,2,2,3,1,0,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,6,6,2,2,2,2,2,2,6,6,0,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,3,3,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,1,1,1,0,0],
      [0,0,0,1,2,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,1,2,2,1,0,1,1,1,0,0,0,0,0],
      [0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0]
    ],
    // 开心
    happy: [
      [0,0,7,0,0,0,0,0,0,0,0,7,0,0,0,0],
      [0,7,7,7,5,5,0,0,0,5,7,7,7,0,0,0],
      [0,0,7,5,6,5,5,5,5,6,5,7,0,0,0,0],
      [0,0,0,0,5,5,5,5,5,5,5,5,0,0,0,0],
      [0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0],
      [0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
      [0,0,0,0,1,3,2,2,2,2,7,1,0,0,0,0],
      [0,0,0,0,1,1,2,2,2,2,1,1,0,0,0,0],
      [0,0,0,6,6,2,1,1,1,1,2,6,6,0,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,3,3,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0]
    ],
    // 伤心
    sad: [
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,5,5,0,0,0,5,5,0,0,0,0,0],
      [0,0,0,5,6,5,5,5,5,6,5,5,0,0,0,0],
      [0,0,0,0,5,5,5,5,5,5,5,5,0,0,0,0],
      [0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0],
      [0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
      [0,0,0,0,1,1,1,2,2,1,1,1,0,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,6,6,2,2,1,1,2,2,6,6,0,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,3,3,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0]
    ],
    // 生病
    sick: [
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,5,5,0,0,0,5,5,0,0,0,0,0],
      [0,0,0,5,5,5,5,5,5,5,5,5,0,0,0,0],
      [0,0,0,0,5,5,5,5,5,5,5,5,0,0,0,0],
      [0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0],
      [0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
      [0,0,0,0,1,1,1,2,2,1,1,1,0,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,6,6,2,2,2,2,2,2,6,6,0,0,0],
      [0,0,1,2,2,2,1,2,2,1,2,2,2,1,0,0],
      [0,0,1,3,3,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0]
    ]
  },
  
  // 成年宠物 - 成熟期 (双层心形+小翅膀+花纹)
  adult: {
    idle: [
      // 小翅膀 + 双层心形
      [0,7,7,0,0,0,1,1,0,1,1,0,0,0,7,7],
      [7,3,3,7,0,1,6,1,1,6,1,1,0,7,3,3],
      [0,7,3,0,0,1,1,1,1,1,1,1,0,0,3,7],
      [0,0,7,0,0,0,1,1,1,1,1,0,0,0,7,0],
      [0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
      // 宠物本体
      [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
      [0,0,0,1,2,7,2,2,2,2,7,2,1,0,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,1,7,1,2,2,1,7,1,2,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,2,2,1,1,1,1,2,2,2,1,0,0],
      // 身体花纹
      [0,0,0,1,2,3,2,2,2,2,3,2,1,0,0,0],
      [0,0,0,1,3,2,2,3,3,2,2,3,1,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,0,1,2,1,0,0,1,2,1,0,0,0,0]
    ],
    walk1: [
      [0,7,7,0,0,0,1,1,0,1,1,0,0,0,7,7],
      [7,3,3,7,0,1,6,1,1,6,1,1,0,7,3,3],
      [0,7,3,0,0,1,1,1,1,1,1,1,0,0,3,7],
      [0,0,7,0,0,0,1,1,1,1,1,0,0,0,7,0],
      [0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
      [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
      [0,0,0,1,2,7,2,2,2,2,7,2,1,0,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,1,7,1,2,2,1,7,1,2,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,2,2,1,1,1,1,2,2,2,1,0,0],
      [0,0,0,1,2,3,2,2,2,2,3,2,1,0,0,0],
      [0,1,1,1,3,2,2,3,3,2,2,3,1,0,0,0],
      [0,0,0,0,0,1,2,2,2,2,2,1,2,1,0,0],
      [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0]
    ],
    walk2: [
      [0,7,7,0,0,0,1,1,0,1,1,0,0,0,7,7],
      [7,3,3,7,0,1,6,1,1,6,1,1,0,7,3,3],
      [0,7,3,0,0,1,1,1,1,1,1,1,0,0,3,7],
      [0,0,7,0,0,0,1,1,1,1,1,0,0,0,7,0],
      [0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
      [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
      [0,0,0,1,2,7,2,2,2,2,7,2,1,0,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,1,7,1,2,2,1,7,1,2,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,2,2,1,1,1,1,2,2,2,1,0,0],
      [0,0,0,1,2,3,2,2,2,2,3,2,1,1,1,0],
      [0,0,0,1,3,2,2,3,3,2,2,3,1,0,0,0],
      [0,0,1,2,1,1,2,2,2,2,1,0,0,0,0,0],
      [0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0]
    ],
    happy: [
      [0,7,7,0,0,0,1,1,0,1,1,0,0,0,7,7],
      [7,3,3,7,0,1,6,1,1,6,1,1,0,7,3,3],
      [0,7,3,0,0,1,1,1,1,1,1,1,0,0,3,7],
      [0,0,7,0,0,0,1,1,1,1,1,0,0,0,7,0],
      [0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
      [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
      [0,0,0,1,2,7,2,2,2,2,7,2,1,0,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,1,1,1,2,2,1,1,1,2,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,2,1,1,1,1,1,1,2,2,1,0,0],
      [0,0,0,1,2,3,2,2,2,2,3,2,1,0,0,0],
      [0,0,0,1,3,2,2,3,3,2,2,3,1,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,0,1,2,1,0,0,1,2,1,0,0,0,0]
    ],
    sad: [
      [0,0,0,0,0,0,1,1,0,1,1,0,0,0,0,0],
      [0,0,0,0,0,1,6,1,1,6,1,1,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
      [0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0],
      [0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
      [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
      [0,0,0,1,2,1,1,2,2,1,1,2,1,0,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,1,7,1,2,2,1,7,1,2,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,2,2,2,1,1,2,2,2,2,1,0,0],
      [0,0,0,1,2,3,2,2,2,2,3,2,1,0,0,0],
      [0,0,0,1,3,2,2,3,3,2,2,3,1,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,0,1,2,1,0,0,1,2,1,0,0,0,0]
    ],
    sick: [
      [0,0,0,0,0,0,1,1,0,1,1,0,0,0,0,0],
      [0,0,0,0,0,1,6,1,1,6,1,1,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
      [0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0],
      [0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
      [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
      [0,0,0,1,2,1,1,2,2,1,1,2,1,0,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,1,7,1,2,2,1,7,1,2,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,2,1,2,2,2,2,1,2,2,1,0,0],
      [0,0,0,1,2,3,2,2,2,2,3,2,1,0,0,0],
      [0,0,0,1,3,2,2,3,3,2,2,3,1,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,0,1,2,1,0,0,1,2,1,0,0,0,0]
    ]
  },
  
  // 手部精灵
  hand: {
    hold: [
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
      [0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0],
      [0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ]
  },
  
  // 状态图标 (8x8)
  icons: {
    heart: [
      [0,1,1,0,0,1,1,0],
      [1,2,2,1,1,2,2,1],
      [1,2,2,2,2,2,2,1],
      [1,2,2,2,2,2,2,1],
      [0,1,2,2,2,2,1,0],
      [0,0,1,2,2,1,0,0],
      [0,0,0,1,1,0,0,0],
      [0,0,0,0,0,0,0,0]
    ],
    zzz: [
      [1,1,1,1,1,0,0,0],
      [0,0,0,1,0,0,0,0],
      [0,0,1,0,0,0,0,0],
      [1,1,1,1,1,0,0,0],
      [0,0,0,0,0,0,0,0],
      [0,0,1,1,1,0,0,0],
      [0,0,0,1,0,0,0,0],
      [0,0,1,1,1,0,0,0]
    ],
    work: [
      [1,1,1,1,1,1,1,1],
      [1,0,0,0,0,0,0,1],
      [1,1,1,1,1,1,1,1],
      [0,1,2,2,2,2,1,0],
      [0,1,2,2,2,2,1,0],
      [0,1,2,2,2,2,1,0],
      [0,1,2,2,2,2,1,0],
      [0,1,1,1,1,1,1,0]
    ],
    study: [
      [0,1,1,1,1,1,1,0],
      [1,2,2,2,2,2,2,1],
      [1,2,1,1,1,1,2,1],
      [1,2,1,1,1,1,2,1],
      [1,2,1,1,1,1,2,1],
      [1,2,2,2,2,2,2,1],
      [0,1,1,1,1,1,1,0],
      [0,0,0,0,0,0,0,0]
    ],
    sick: [
      [0,0,1,1,1,1,0,0],
      [0,1,2,2,2,2,1,0],
      [1,2,1,2,2,1,2,1],
      [1,2,2,2,2,2,2,1],
      [1,2,2,1,1,2,2,1],
      [0,1,2,2,2,2,1,0],
      [0,0,1,1,1,1,0,0],
      [0,0,0,0,0,0,0,0]
    ]
  },
  
  // 稀有变种精灵 (32x32)
  rare: {
    // 动画帧1 - 鎏金心形 + 迷你皇冠 + 渐变花纹
    frame1: [
      // 星光点缀 + 皇冠 + 心形
      [0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0],
      // 皇冠 (8x8)
      [0,0,0,0,0,0,0,0,0,0,0,0,8,4,4,4,4,4,4,8,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,8,4,5,4,8,8,4,5,4,8,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,8,4,4,4,4,4,4,4,4,8,0,0,0,0,0,0,0,0,0,0,0],
      // 双层心形 (鎏金外层 + 浅紫内层)
      [0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,4,5,3,3,4,0,0,0,0,0,0,0,4,3,3,5,4,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,4,3,3,3,3,4,4,4,4,4,4,4,3,3,3,3,4,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,4,3,3,3,3,3,3,3,3,3,3,3,3,3,4,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,4,3,3,3,3,3,3,3,3,3,3,3,4,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,4,3,3,3,3,3,3,3,3,3,4,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,4,3,3,3,3,3,3,3,4,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,4,3,3,3,3,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      // 宠物本体 (浅银描边)
      [0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,7,3,3,7,3,3,3,3,3,3,7,3,3,3,7,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,7,3,7,3,3,3,4,3,3,3,4,3,3,3,7,3,7,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,0,0,0,0,0,0,0],
      [0,0,9,0,0,0,7,3,3,1,7,1,3,3,3,3,3,3,3,1,7,1,3,3,7,0,0,9,0,0,0,0],
      [0,9,9,9,0,0,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,0,9,9,9,0,0,0],
      [0,0,9,0,0,0,7,3,3,3,3,3,3,1,1,1,1,1,1,3,3,3,3,3,7,0,0,9,0,0,0,0],
      // 身体渐变花纹 (浅紫→鎏金)
      [0,0,0,0,0,0,0,7,3,3,4,3,3,3,3,3,3,3,3,3,3,4,3,7,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,7,3,4,5,4,3,4,3,3,3,4,3,4,5,4,3,7,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,7,3,4,3,4,5,4,3,4,5,4,3,4,3,7,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,7,3,3,4,5,4,3,3,3,4,5,4,3,3,7,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,7,3,3,4,3,3,3,3,3,4,3,3,7,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,7,3,3,3,3,3,3,3,3,3,7,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,7,3,3,3,3,3,3,3,7,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,7,3,3,7,0,0,7,3,3,7,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,0,0,7,7,7,7,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ],
    // 动画帧2 - 心形金边闪烁 + 星光切换
    frame2: [
      // 星光位置切换
      [0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0],
      [0,0,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,0,0],
      [0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0],
      // 皇冠 (亮金闪烁)
      [0,0,0,0,0,0,0,0,0,0,0,0,8,5,5,5,5,5,5,8,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,8,5,4,5,8,8,5,4,5,8,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,8,5,5,5,5,5,5,5,5,8,0,0,0,0,0,0,0,0,0,0,0],
      // 双层心形 (金边变亮)
      [0,0,0,0,0,0,0,0,5,5,5,0,0,0,0,0,0,0,0,0,5,5,5,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,5,4,3,3,5,0,0,0,0,0,0,0,5,3,3,4,5,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,5,3,3,3,3,5,5,5,5,5,5,5,3,3,3,3,5,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,5,3,3,3,3,3,3,3,3,3,3,3,3,3,5,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,5,3,3,3,3,3,3,3,3,3,3,3,5,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,5,3,3,3,3,3,3,3,3,3,5,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,5,3,3,3,3,3,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,5,3,3,3,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      // 宠物本体 (相同)
      [0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,7,3,3,7,3,3,3,3,3,3,7,3,3,3,7,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,7,3,7,3,3,3,4,3,3,3,4,3,3,3,7,3,7,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,0,0,0,0,0,0,0],
      [0,0,0,0,9,0,7,3,3,1,7,1,3,3,3,3,3,3,3,1,7,1,3,3,7,0,9,0,0,0,0,0],
      [0,0,0,9,9,9,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,9,9,9,0,0,0,0],
      [0,0,0,0,9,0,7,3,3,3,3,3,3,1,1,1,1,1,1,3,3,3,3,3,7,0,9,0,0,0,0,0],
      // 身体花纹
      [0,0,0,0,0,0,0,7,3,3,4,3,3,3,3,3,3,3,3,3,3,4,3,7,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,7,3,4,5,4,3,4,3,3,3,4,3,4,5,4,3,7,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,7,3,4,3,4,5,4,3,4,5,4,3,4,3,7,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,7,3,3,4,5,4,3,3,3,4,5,4,3,3,7,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,7,3,3,4,3,3,3,3,3,4,3,3,7,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,7,3,3,3,3,3,3,3,3,3,7,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,7,3,3,3,3,3,3,3,7,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,7,3,3,7,0,0,7,3,3,7,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,0,0,7,7,7,7,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ]
  }
}

// 像素精灵渲染类
class PixelRenderer {
  constructor(canvas, scale = 6) {
    this.canvas = canvas
    this.ctx = canvas.getContext('2d')
    this.scale = scale
    this.currentFrame = 0
    this.animationTimer = null
    this.isWalking = false
    this.direction = 1 // 1: 右, -1: 左
  }
  
  // 设置缩放
  setScale(scale) {
    this.scale = scale
    this.canvas.width = 16 * scale
    this.canvas.height = 20 * scale  // 增加高度以容纳手+宠物
    // 禁用抗锯齿以保持像素清晰
    this.ctx.imageSmoothingEnabled = false
  }
  
  // 清空画布
  clear() {
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)
  }
  
  // 绘制精灵 (支持扩展颜色)
  drawSprite(spriteData, offsetX = 0, offsetY = 0, flipX = false) {
    // 0=透明, 1=深色, 2=中间色, 3=浅色, 4=淡紫, 5=粉色, 6=黄色, 7=白色, 8=裂纹, 9=星光
    const colorMap = [
      'transparent',
      COLORS.dark,
      COLORS.mid,
      COLORS.light,
      COLORS.paleViolet,
      COLORS.pink,
      COLORS.yellow,
      COLORS.white,
      '#8a7aaa',  // 裂纹色
      COLORS.gold   // 星光
    ]
    
    for (let y = 0; y < spriteData.length; y++) {
      for (let x = 0; x < spriteData[y].length; x++) {
        const pixel = spriteData[y][x]
        if (pixel === 0) continue
        
        this.ctx.fillStyle = colorMap[pixel] || COLORS.mid
        const drawX = flipX 
          ? (15 - x) * this.scale + offsetX 
          : x * this.scale + offsetX
        const drawY = y * this.scale + offsetY
        this.ctx.fillRect(drawX, drawY, this.scale, this.scale)
      }
    }
  }
  
  // 绘制小图标 (8x8)
  drawIcon(iconData, x, y) {
    const colorMap = ['transparent', COLORS.dark, COLORS.mid]
    const iconScale = this.scale * 0.5
    
    for (let iy = 0; iy < iconData.length; iy++) {
      for (let ix = 0; ix < iconData[iy].length; ix++) {
        const pixel = iconData[iy][ix]
        if (pixel === 0) continue
        
        this.ctx.fillStyle = colorMap[pixel]
        this.ctx.fillRect(
          x + ix * iconScale, 
          y + iy * iconScale, 
          iconScale, 
          iconScale
        )
      }
    }
  }
  
  // 渲染宠物
  renderPet(stage, mood, sick, isMoving, direction) {
    this.clear()
    this.direction = direction
    
    let sprite
    
    // 稀有变种特殊处理
    if (stage === 'rare') {
      // 2帧动画切换
      sprite = this.currentFrame % 2 === 0 
        ? SPRITES.rare.frame1
        : SPRITES.rare.frame2
    } else if (stage === 'egg') {
      // 蛋 - 偶尔摇晃
      sprite = this.currentFrame % 60 < 50 
        ? SPRITES.egg.idle 
        : SPRITES.egg.wobble
    } else {
      const stageSprites = SPRITES[stage]
      if (!stageSprites) return
      
      if (sick) {
        sprite = stageSprites.sick
      } else if (mood >= 70) {
        sprite = stageSprites.happy
      } else if (mood < 40) {
        sprite = stageSprites.sad
      } else if (isMoving) {
        // 走路动画
        sprite = this.currentFrame % 2 === 0 
          ? stageSprites.walk1 
          : stageSprites.walk2
      } else {
        sprite = stageSprites.idle
      }
    }
    
    if (sprite) {
      // 居中绘制，留出顶部空间
      this.drawSprite(sprite, 0, this.scale * 2, direction < 0)
    }
  }
  
  // 渲染被拖动状态 (手+宠物)
  renderHolding(stage) {
    this.clear()
    
    // 绘制手 (顶部)
    this.drawSprite(SPRITES.hand.hold, 0, 0)
    
    // 绘制宠物（手下方）
    const sprite = stage === 'egg' 
      ? SPRITES.egg.idle 
      : SPRITES[stage]?.idle
    
    if (sprite) {
      this.drawSprite(sprite, 0, this.scale * 4)
    }
  }
  
  // 渲染状态图标
  renderStatusIcon(status) {
    const iconMap = {
      work: SPRITES.icons.work,
      study: SPRITES.icons.study,
      sick: SPRITES.icons.sick,
      sleep: SPRITES.icons.zzz
    }
    
    const icon = iconMap[status]
    if (icon) {
      this.drawIcon(icon, this.canvas.width - 30, 0)
    }
  }
  
  // 开始动画循环
  startAnimation(callback) {
    if (this.animationTimer) return
    
    this.animationTimer = setInterval(() => {
      this.currentFrame++
      if (callback) callback(this.currentFrame)
    }, 200) // 5fps 复古动画
  }
  
  // 停止动画
  stopAnimation() {
    if (this.animationTimer) {
      clearInterval(this.animationTimer)
      this.animationTimer = null
    }
  }
}

// 导出
window.PixelRenderer = PixelRenderer
window.SPRITES = SPRITES
window.updateColors = updateColors
window.getColors = () => COLORS
