# 桌面电子宠物（QQ宠物风格）项目文档

## 项目概述
- 目标：打造经典QQ宠物体验的桌面养成游戏，核心是"打工赚钱 + 养成消费 + 桌面互动"。
- 平台：Windows 桌面单机（Electron + TypeScript），全部信息本地存储，不联网。
- 首版范围（MVP）：单宠物养成、打工系统、商店购物、桌面互动、本地存档与离线结算。

## 用户与场景
- 用户画像：QQ宠物怀旧用户、休闲养成玩家、碎片时间用户。
- 使用场景：桌面常驻，每天多次互动（喂食、打工、购物）；宠物在桌面自由活动提供陪伴感。
- 参与强度：轻度养成，允许离线挂机打工；支持软失败（生病/心情低）但不会真正死亡。

## 核心差异化（相比原设计）
- ❌ 删除：自定义图片生成、电光舞主题、复杂技能系统、捣蛋模式
- ✅ 聚焦：经典QQ宠物的经济循环、打工学习、桌面互动、可爱卡通风格

# 核心玩法（QQ宠物风格）

### 1. 养成系统
- **基础属性**（0-100）：
  - 饥饿值：每小时 +20，≥80 时心情下降，≥100 生病
  - 清洁值：每小时 -15，≤20 时可能生病
  - 心情值：受饥饿、清洁、互动影响，影响打工效率
  - 健康值：生病时下降，≤0 强制休息

- **成长属性**（影响打工收入）：
  - 等级：通过打工/学习获得经验升级
  - 武力值：影响体力类工作收入
  - 智力值：影响脑力类工作收入
  - 魅力值：影响服务类工作收入

- **基础互动**：
  - 喂食：消耗食物（需购买），降低饥饿 -30
  - 洗澡：消耗清洁用品，提升清洁 +40
  - 玩耍：消耗玩具耐久，提升心情 +20
  - 吃药：消耗药品，治疗疾病

### 2. 经济系统（核心）
- **打工赚元宝**：
  - 初级工作：服务员（+5元宝/小时，需魅力≥10）
  - 中级工作：建筑工（+15元宝/小时，需武力≥30）
  - 高级工作：程序员（+30元宝/小时，需智力≥50）
  - 打工时长：2-8小时可选，期间宠物显示工作状态
  - 心情影响：心情≥60 收入100%，心情<60 收入减半

- **学习提升属性**：
  - 武馆学习：消耗20元宝/次，武力 +5
  - 图书馆学习：消耗20元宝/次，智力 +5
  - 美容院：消耗30元宝/次，魅力 +5
  - 学习需要2小时，期间不能打工

- **商店购物**：
  - 食物：面包(5元宝)、牛排(20元宝)、大餐(50元宝)
  - 用品：香皂(10元宝)、沐浴露(30元宝)
  - 玩具：皮球(15元宝)、遥控车(50元宝)、游戏机(100元宝)
  - 药品：感冒药(20元宝)、营养液(40元宝)
  - 装饰：帽子、衣服、背景（后期扩展）

### 3. 桌面互动
- **自由移动**：
  - 随机在桌面走动、坐下、躺下、玩耍
  - 边缘检测自动转向，支持多显示器
  - 闲置时随机动作（挠头、伸懒腰、打哈欠）

- **鼠标互动**：
  - 左键点击：抚摸，心情 +2，播放开心动画
  - 右键点击：打开快捷菜单（喂食、洗澡、玩耍、打工、商店）
  - 拖拽：可拖动宠物到任意位置

- **对话气泡**：
  - 随机说话："主人，我饿了"、"好无聊啊"、"我想去打工"
  - 状态提醒：饥饿≥80、清洁≤20、生病时弹出气泡
  - 打工完成提示："赚了15元宝，好开心！"

- **状态展示**：
  - 头顶图标：工作中、学习中、生病中
  - 表情变化：开心、普通、难过、生病
  - 动作状态：走路、跑步、坐下、睡觉、玩耍

### 4. 成长进化
- **阶段**：蛋（0级） → 幼年（1-10级） → 成年（11级+）
- **进化条件**：等级达成 + 属性要求（武力/智力/魅力任一≥30）
- **外观变化**：预设3-5种进化形态的精灵图
- **能力解锁**：成年后解锁高级工作和装饰系统

# 数值规则（QQ宠物平衡）

### 属性衰减
- 饥饿：每小时 +20（12小时吃一次）
- 清洁：每小时 -15（15小时洗一次）
- 心情：基础不衰减，受饥饿/清洁影响下降

### 经济平衡
- **收入**：初级5/h → 中级15/h → 高级30/h
- **日常消费**：食物5-50、用品10-30、玩具15-100
- **学习投资**：20-30元宝/次，需多次提升属性
- **设计目标**：打工2-3小时可满足一天基本需求，额外收入用于学习和装饰

### 离线结算
- 离线<12小时：正常结算属性衰减和打工收入
- 离线12-24小时：属性降至临界值（饥饿80、清洁20）但不生病
- 离线>24小时：进入"休眠保护"，停止所有变化
- 打工中离线：继续计算收入，最多8小时

## 系统设计

### 技术栈
- **框架**：Electron + TypeScript
- **渲染**：Canvas 2D（卡通精灵图，无需WebGL）
- **UI库**：原生HTML/CSS（主菜单、商店界面）
- **数据**：本地JSON存储，完全离线

### 核心模块
```
src/
  core/
    pet.ts          # 宠物状态管理（属性、等级、阶段）
    economy.ts      # 经济系统（元宝、打工、购物）
    growth.ts       # 成长系统（经验、属性提升、进化）
    events.ts       # 随机事件（生病、对话）
  desktop/
    movement.ts     # 移动逻辑（随机漫步、边界检测）
    animations.ts   # 动画状态机（走、坐、躺、工作）
    interactions.ts # 鼠标交互（点击、拖拽）
  ui/
    renderer.ts     # Canvas渲染（精灵图绘制）
    dialogs.ts      # 气泡对话
    panels/
      shop.ts       # 商店界面
      status.ts     # 状态面板
      work.ts       # 打工面板
  data/
    jobs.json       # 工作配置（名称、收入、要求）
    items.json      # 商品配置（价格、效果）
    sprites/        # 精灵图资源
      egg.png
      baby_*.png
      adult_*.png
```

### 状态更新
- **实时循环**：每秒 tick()，计算属性衰减
- **打工计时**：独立计时器，到期结算收入并触发通知
- **离线结算**：加载时对比时间戳，一次性结算
- **幂等设计**：重复调用不会累加错误

## 美术风格（可爱卡通）

### 视觉定位
- **风格**：QQ宠物式可爱卡通，明亮色彩，圆润造型
- **色调**：温暖明快（粉色、蓝色、黄色为主）
- **尺寸**：宠物约100x100px，支持多帧动画

### 精灵图动画
- **基础动作**（每个4-8帧）：
  - idle（站立呼吸）
  - walk（走路循环）
  - sit（坐下）
  - sleep（睡觉）
  - eat（吃东西）
  - play（玩耍）
  - work（工作中，头顶工具图标）
  - sick（生病，头顶晕圈）

- **表情系统**：
  - 开心（心情≥60）：眼睛弯曲，嘴角上扬
  - 普通（心情40-60）：正常表情
  - 难过（心情<40）：眉毛下垂，嘴角下弯
  - 生病：脸色发青，冒汗

### UI元素
- **对话气泡**：白色圆角矩形，卡通字体
- **状态图标**：头顶小图标（工作帽、书本、药瓶）
- **菜单面板**：半透明圆角面板，卡通按钮

# 桌面行为

### 移动模式
- **随机漫步**（默认）：
  - 随机选择目标点，匀速移动
  - 到达后停留5-15秒，播放idle/sit动画
  - 边缘检测自动转向（支持多显示器）
  
- **工作/学习状态**：
  - 固定在某位置，播放work/study动画
  - 头顶显示进度条和剩余时间
  - 不响应拖拽，可右键取消

- **睡觉状态**：
  - 心情<30 或健康<30 时自动睡觉
  - 固定不动，播放sleep动画
  - 可被点击唤醒

### 交互响应
- **左键点击**：抚摸 → 播放开心动画 → 心情+2
- **右键点击**：弹出圆形菜单（喂食/洗澡/玩耍/打工/商店/设置）
- **拖拽**：自由拖动到任意位置
- **双击**：打开状态详情面板

### 智能提醒
- 饥饿≥80：每30分钟弹气泡"主人，我饿了"
- 清洁≤20：每30分钟弹气泡"我需要洗澡"
- 打工完成：立即弹气泡"赚了XX元宝！"
- 生病：立即弹气泡"我生病了，需要吃药"

## 数据模型

```typescript
// 宠物状态
interface Pet {
  id: string
  name: string              // 宠物昵称
  stage: 'egg' | 'baby' | 'adult'
  level: number             // 等级 0-99
  exp: number               // 当前经验值
  
  // 基础属性 0-100
  hunger: number            // 饥饿值
  clean: number             // 清洁值  
  mood: number              // 心情值
  health: number            // 健康值
  
  // 成长属性 0-100
  strength: number          // 武力值
  intelligence: number      // 智力值
  charm: number             // 魅力值
  
  // 状态
  sick: boolean             // 是否生病
  currentAction: 'idle' | 'walk' | 'work' | 'study' | 'sleep'
  workingUntil?: number     // 打工结束时间戳
  studyingUntil?: number    // 学习结束时间戳
  
  // 时间
  lastUpdate: number        // 上次更新时间戳
  bornAt: number            // 出生时间
}

// 玩家数据
interface Player {
  coins: number             // 元宝余额
  inventory: Record<string, number>  // 物品背包 {itemId: count}
  settings: {
    soundEnabled: boolean
    autoSave: boolean
    notifyEnabled: boolean
  }
}

// 工作定义
interface Job {
  id: string
  name: string              // 服务员、建筑工、程序员
  income: number            // 每小时收入
  requirement: {            // 解锁要求
    level?: number
    strength?: number
    intelligence?: number
    charm?: number
  }
  duration: number[]        // 可选时长 [2,4,8]
}

// 物品定义
interface Item {
  id: string
  name: string
  type: 'food' | 'clean' | 'toy' | 'medicine'
  price: number
  effects: {
    hunger?: number         // 降低饥饿
    clean?: number          // 提升清洁
    mood?: number           // 提升心情
    health?: number         // 恢复健康
    cure?: boolean          // 治疗疾病
  }
  durability?: number       // 玩具耐久度
}

// 学习项目
interface Study {
  id: string
  name: string              // 武馆、图书馆、美容院
  cost: number              // 消耗元宝
  duration: number          // 学习时长（小时）
  effect: {
    strength?: number
    intelligence?: number
    charm?: number
    exp?: number
  }
}
```

## UI界面设计

### 桌面宠物窗口
- **透明无边框**：仅显示宠物和气泡
- **尺寸**：120x150px（含对话气泡空间）
- **置顶**：始终在其他窗口上方
- **点击穿透**：宠物区域可点击，其余透明区域穿透

### 状态面板（双击打开）
```
┌─────────────────────────┐
│  [宠物形象]  Lv.5 幼年   │
│  昵称：小Q               │
├─────────────────────────┤
│ 饥饿 ████████░░ 80       │
│ 清洁 ████░░░░░░ 40       │
│ 心情 ██████░░░░ 60       │
│ 健康 ██████████ 100      │
├─────────────────────────┤
│ 武力 ████░░░░░░ 35       │
│ 智力 ██░░░░░░░░ 20       │
│ 魅力 ██████░░░░ 55       │
├─────────────────────────┤
│ 元宝：245  经验：350/500│
│ [喂食][洗澡][玩耍]      │
│ [打工][学习][商店]      │
└─────────────────────────┘
```

### 商店界面
```
┌─── 商店 ────────────────┐
│ [食物][用品][玩具][药品]│
├─────────────────────────┤
│ 📦 面包      5元宝      │
│    饥饿 -30             │
│          [购买]         │
│ 📦 牛排     20元宝      │
│    饥饿 -60，心情+10    │
│          [购买]         │
│ ...                     │
└─────────────────────────┘
```

### 打工界面
```
┌─── 打工 ────────────────┐
│ 💼 服务员               │
│    收入：5元宝/小时     │
│    需要：魅力≥10        │
│    [2小时][4小时][8小时]│
│                         │
│ 💼 建筑工（🔒需Lv.5）   │
│    收入：15元宝/小时    │
│    需要：武力≥30        │
└─────────────────────────┘
```

## 非功能性需求

### 性能
- **目标帧率**：30FPS（Canvas 2D简单绘制，无性能压力）
- **CPU占用**：<5%（空闲时）
- **内存占用**：<100MB
- **启动时间**：<2秒

### 稳定性
- 状态更新幂等设计
- 离线结算上限24小时保护
- 自动保存（每分钟）+ 退出保存
- 异常恢复：加载失败使用默认值

### 兼容性
- Windows 10/11 x64
- 多显示器支持
- 不同DPI缩放适配
- 托盘模式常驻

### 资源控制
- 窗口失焦：降低tick频率到10秒/次
- 托盘模式：暂停动画，仅计算属性
- 打工中：正常计时，无需高频刷新

## MVP 验收标准

### 核心功能
- ✅ 宠物基础养成：喂食、洗澡、玩耍正常工作
- ✅ 属性系统：饥饿/清洁/心情/健康正确衰减和恢复
- ✅ 打工系统：至少2种工作，正确计算收入和时长
- ✅ 商店购物：至少6种商品，正确扣除元宝和应用效果
- ✅ 成长系统：经验升级、属性提升、阶段进化
- ✅ 桌面互动：随机移动、点击抚摸、拖拽、气泡对话

### 数值验收
- 离线12小时后回归，属性在合理范围（饥饿≤90，清洁≥10）
- 打工2小时收入可购买1-2天基本食物
- 学习5次可解锁中级工作
- 成长到成年需要约3-5天日常游玩

### 体验验收
- 点击响应<100ms
- 动画流畅无卡顿
- 气泡提示及时准确
- 界面操作符合直觉
- 存档保存不丢失

## 风险与对策

### 开发风险
- **美术资源**：首版使用简化精灵图（4-6帧），可用占位图开发
- **数值平衡**：提供调试面板快速调整，基于QQ宠物经验设定初值
- **复杂度控制**：聚焦核心循环，暂不做社交、结婚等扩展功能

### 体验风险
- **过度打扰**：气泡提醒最多30分钟一次，可设置免打扰时段
- **经济崩溃**：设置元宝上限（9999），避免通货膨胀
- **养成挫败**：软失败设计，生病/心情低不会导致死亡

### 技术风险
- **Electron体积**：打包后约100MB，可接受
- **多屏适配**：使用screen API获取边界，充分测试
- **内存泄漏**：注意动画清理和事件监听解绑

## 版本规划

### v0.1 MVP（核心养成循环）- 2周
- ✅ 宠物状态系统（4个基础属性）
- ✅ 基础互动（喂食、洗澡、玩耍）
- ✅ 桌面移动和动画
- ✅ 本地存档和离线结算
- ✅ 简单UI面板

### v0.2 经济系统 - 2周
- ✅ 打工系统（3种工作）
- ✅ 商店系统（10+种商品）
- ✅ 元宝经济循环
- ✅ 学习系统（属性提升）
- ✅ 等级和经验

### v0.3 成长与互动 - 2周  
- ✅ 阶段进化（蛋→幼年→成年）
- ✅ 多套精灵图和动画
- ✅ 对话气泡系统
- ✅ 智能提醒
- ✅ 音效系统

### v0.4 扩展与优化 - 2周
- ✅ 装饰系统（衣服、帽子、背景）
- ✅ 每日任务和奖励
- ✅ 成就收藏册
- ✅ 数值平衡调优
- ✅ 性能优化和bug修复

### v1.0 正式版
- 完整测试和打包
- 用户文档
- 安装包发布

### 后续扩展（可选）
- 小游戏（打地鼠、答题）
- 好友系统（本地联机）
- 结婚生蛋
- 宠物PK
 
## 打包与分发
- 使用 `electron-builder` 生成Windows安装包
- 支持安装版（Setup.exe）和便携版
- 完全离线，无网络依赖
- 数据存储在用户目录 `%AppData%/ElectronicPet`
- 详见 [PACKAGING.md](PACKAGING.md)

## 开发里程碑

### Week 1-2: MVP核心
- Day 1-3: 项目初始化、Electron窗口、Canvas渲染
- Day 4-7: 宠物状态系统、属性衰减、基础互动
- Day 8-10: 桌面移动、动画系统、鼠标交互
- Day 11-14: 存档系统、离线结算、UI面板

### Week 3-4: 经济系统
- Day 15-17: 打工系统、计时器、收入结算
- Day 18-21: 商店系统、物品效果、背包管理
- Day 22-24: 学习系统、属性提升、等级经验
- Day 25-28: 数值平衡、测试调优

### Week 5-6: 成长互动
- Day 29-32: 进化系统、多套精灵图
- Day 33-35: 对话气泡、智能提醒
- Day 36-38: 音效系统、反馈优化
- Day 39-42: 整体测试、bug修复

### Week 7-8: 打磨发布
- Day 43-46: 装饰系统、任务系统
- Day 47-49: 性能优化、兼容性测试
- Day 50-52: 文档编写、打包测试
- Day 53-56: 最终调优、正式发布

## 本地数据统计（调试用）
- 日均互动次数
- 各功能使用频率（喂食/打工/购物）
- 元宝收支流水
- 属性变化曲线
- 仅本地存储JSON，用于数值调优

## 目录结构
```
electronic-pet/
  src/
    core/              # 核心逻辑
      pet.ts           # 宠物状态
      economy.ts       # 经济系统
      growth.ts        # 成长系统
      events.ts        # 事件系统
    desktop/           # 桌面交互
      movement.ts      # 移动逻辑
      animations.ts    # 动画状态机
      interactions.ts  # 鼠标交互
    ui/                # 界面
      renderer.ts      # Canvas渲染
      dialogs.ts       # 气泡对话
      panels/          # 各种面板
        status.ts
        shop.ts
        work.ts
    data/              # 配置数据
      jobs.json        # 工作配置
      items.json       # 商品配置
      studies.json     # 学习配置
    utils/             # 工具函数
      storage.ts       # 存档管理
      time.ts          # 时间计算
    main.ts            # 主进程
    preload.ts         # 预加载
  assets/
    sprites/           # 精灵图
      egg/
      baby/
      adult/
    sounds/            # 音效
    icons/             # 托盘图标
  dist/                # 编译输出
  dist_electron/       # 打包输出
```

## 下一步行动

### 立即开始
1. 初始化Electron + TypeScript项目
2. 搭建透明窗口和Canvas渲染
3. 实现宠物状态系统和属性衰减
4. 完成基础互动（喂食、洗澡、玩耍）
5. 实现桌面移动和简单动画

### 参考资料
- QQ宠物数值参考：打工收入、商品价格、属性衰减
- Electron官方文档：透明窗口、托盘、多显示器
- Canvas动画教程：精灵图绘制、帧动画

---

**核心理念**：聚焦QQ宠物的经典体验 —— 打工赚钱、养成消费、桌面陪伴。删除所有过度设计，回归简单快乐的养成循环。
